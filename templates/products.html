{% extends "base.html" %}

{% block title %}Products{% endblock %}

{% block content %}
<header class="page-header">
    <h1>Products</h1>
    <p>Browse available compute plans per region. Cards below update the <code>region_id</code> query parameter.</p>
    {% if selected_region.is_some() %}
    <p class="page-status">Showing products for <strong>{{ selected_region.as_ref().unwrap().name }}</strong> (ID {{ selected_region.as_ref().unwrap().id }}).</p>
    {% else if requested_region.is_some() %}
    <p class="page-status warning">No region with ID {{ requested_region.as_ref().unwrap() }} was found.</p>
    {% endif %}
</header>

<section>
    <h2>Select a region</h2>
    <p>Click one of the cards to filter the list. You can also bookmark the resulting URL.</p>
    {% if regions.len() > 0 %}
    <div class="region-grid" role="list">
                {% for region in regions %}
        <a class="region-card" role="listitem" href="{{ base_url }}/products?region_id={{ region.id }}" {% if active_region_id == region.id %}aria-current="true"{% endif %}>
            <div class="region-heading">
                <h3>{{ region.name }}</h3>
                <span class="region-chip">{{ region.country }}</span>
            </div>
            <p class="region-subtitle">Region ID {{ region.id }}</p>
            <p class="region-description">{{ region.city }}</p>
            <span class="region-cta" aria-hidden="true">{% if active_region_id == region.id %}Viewing products{% else %}View products ‚Üí{% endif %}</span>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <small>No regions are available at this time.</small>
    {% endif %}
</section>

<section>
    <h2>Product catalog</h2>
    {% if selected_region.is_some() %}
    <p>Plans available in {{ selected_region.as_ref().unwrap().name }}. Pricing and specifications come directly from the API.</p>
    {% else %}
    <p>Select a region above to load its product inventory.</p>
    {% endif %}

    {% if selected_region.is_some() %}
        {% if products.len() > 0 %}
        <div class="product-grid" role="list">
            {% for product in products %}
            <article class="product-card" role="listitem">
                <div class="product-card-body">
                    {% if product.price_entries.len() > 0 %}
                    {% for entry in product.price_entries %}
                    {% if loop.index == 1 %}
                    <div class="product-price">{{ entry.value }}</div>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    <div class="product-highlights">
                        {% if product.cpu.is_some() %}
                        <span><strong>CPU:</strong> {{ product.cpu.as_ref().unwrap() }}</span>
                        {% endif %}
                        {% if product.ram.is_some() %}
                        <span><strong>RAM:</strong> {{ product.ram.as_ref().unwrap() }}</span>
                        {% endif %}
                        {% if product.storage.is_some() %}
                        <span><strong>Storage:</strong> {{ product.storage.as_ref().unwrap() }}</span>
                        {% endif %}
                        {% if product.bandwidth.is_some() %}
                        <span><strong>Bandwidth:</strong> {{ product.bandwidth.as_ref().unwrap() }}</span>
                        {% endif %}
                    </div>
                    {% if product.description != "" %}
                    <p>{{ product.description }}</p>
                    {% endif %}
                    {% if product.tags != "" %}
                    <footer>
                        <p>{{ product.tags }}</p>
                    </footer>
                    {% endif %}
                </div>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <p>üì¶ No products are currently returned for this region.</p>
        {% endif %}
    {% else if requested_region.is_some() %}
        <p>üåç We could not find a region with ID {{ requested_region.as_ref().unwrap() }}.</p>
    {% endif %}
</section>
{% endblock %}