{% extends "base.html" %}

{% block title %}Products{% endblock %}

{% block content %}
<header class="page-header">
    <h1>Products</h1>
    <p>Browse available compute plans per region. Cards below update the <code>region_id</code> query parameter.</p>
    {% if selected_region.is_some() %}
    <p class="page-status">Showing products for <strong>{{ selected_region.as_ref().unwrap().name }}</strong> (ID {{ selected_region.as_ref().unwrap().id }}).</p>
    {% else if requested_region.is_some() %}
    <p class="page-status warning">No region with ID {{ requested_region.as_ref().unwrap() }} was found.</p>
    {% endif %}
</header>

<section>
    <h2>Select a region</h2>
    <p>Click one of the cards to filter the list. You can also bookmark the resulting URL.</p>
    {% if regions.len() > 0 %}
    <div class="region-grid" role="list">
                {% for region in regions %}
        <a class="region-card" role="listitem" href="{{ base_url }}/products?region_id={{ region.id }}" {% if active_region_id == region.id %}aria-current="true"{% endif %}>
            <div class="region-heading">
                <h3>{{ region.name }}</h3>
                {% if region.abbr.is_some() %}
                <span class="region-chip">{{ region.abbr.as_ref().unwrap() }}</span>
                {% endif %}
            </div>
            <p class="region-subtitle">Region ID {{ region.id }}</p>
            {% if region.description.is_some() %}
            <p class="region-description">{{ region.description.as_ref().unwrap() }}</p>
            {% endif %}
            <dl class="region-metrics">
                <div>
                    <dt>Status</dt>
                    {% if region.is_active %}
                    <dd>Active</dd>
                    {% else %}
                    <dd>Disabled</dd>
                    {% endif %}
                </div>
                <div>
                    <dt>Premium tier</dt>
                    {% if region.is_premium %}
                    <dd>Yes</dd>
                    {% else %}
                    <dd>No</dd>
                    {% endif %}
                </div>
                {% if region.ram_threshold_gb.is_some() %}
                <div>
                    <dt>RAM threshold</dt>
                    <dd>{{ region.ram_threshold_gb.as_ref().unwrap() }} GB</dd>
                </div>
                {% endif %}
                {% if region.disk_threshold_gb.is_some() %}
                <div>
                    <dt>Disk threshold</dt>
                    <dd>{{ region.disk_threshold_gb.as_ref().unwrap() }} GB</dd>
                </div>
                {% endif %}
            </dl>
            <span class="region-cta" aria-hidden="true">{% if active_region_id == region.id %}Viewing products{% else %}View products ‚Üí{% endif %}</span>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <small>No regions are available at this time.</small>
    {% endif %}
</section>

<section>
    <h2>Product catalog</h2>
    {% if selected_region.is_some() %}
    <p>Plans available in {{ selected_region.as_ref().unwrap().name }}. Pricing and specifications come directly from the API.</p>
    {% else %}
    <p>Select a region above to load its product inventory.</p>
    {% endif %}

    {% if selected_region.is_some() %}
        {% if products.len() > 0 %}
        <div class="product-grid" role="list">
            {% for product in products %}
            <article class="product-card" role="listitem">
                <div class="product-card-body">
                    <h2>{{ product.display_name }}</h2>
                    {% if product.tags != "" %}
                    <p class="product-plan">{{ product.tags }}</p>
                    {% endif %}
                    {% if product.price_entries.len() > 0 %}
                    {% for entry in product.price_entries %}
                    {% if loop.index == 1 %}
                    <div class="product-price">{{ entry.value }}</div>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% if product.description != "" %}
                    <p>{{ product.description }}</p>
                    {% endif %}
                    {% if product.spec_entries.len() > 0 %}
                    <dl>
                        {% for entry in product.spec_entries %}
                        <div>
                            <dt>{{ entry.term }}</dt>
                            <dd>{{ entry.value }}</dd>
                        </div>
                        {% endfor %}
                    </dl>
                    {% endif %}
                    {% if product.price_entries.len() > 0 %}
                    <dl class="pricing">
                        {% for entry in product.price_entries %}
                        <div>
                            <dt>{{ entry.term }}</dt>
                            <dd>{{ entry.value }}</dd>
                        </div>
                        {% endfor %}
                    </dl>
                    {% endif %}
                    {% if product.tags != "" %}
                    <footer>
                        <p>{{ product.tags }}</p>
                    </footer>
                    {% endif %}
                </div>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <p>üì¶ No products are currently returned for this region.</p>
        {% endif %}
    {% else if requested_region.is_some() %}
        <p>üåç We could not find a region with ID {{ requested_region.as_ref().unwrap() }}.</p>
    {% endif %}
</section>
{% endblock %}