{% extends "base.html" %}

{% block title %}Instances{% endblock %}

{% block content %}
<h1>Instances</h1>

<div class="list-filters">
    <form method="get" action="{{ base_url }}/instances" class="d-flex gap-md align-center flex-wrap">
        <div class="form-group mb-0">
            <label class="sr-only" for="per_page">Items per page</label>
            <select name="per_page" id="per_page" class="form-control form-select-sm" onchange="this.form.submit()">
                <option value="10" {% if per_page == 10 %}selected{% endif %}>10 per page</option>
                <option value="20" {% if per_page == 20 %}selected{% endif %}>20 per page</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50 per page</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100 per page</option>
            </select>
        </div>
        <input type="hidden" name="page" value="1">
    </form>
</div>

{% if instances.len() > 0 %}
<div class="table-responsive mt-4">
    <table class="table">
        <thead>
            <tr>
                <th>Hostname</th>
                <th>ID</th>
                <th>Status</th>
                <th class="text-right">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for instance in instances %}
                <tr>
                    <td><strong>{{ instance.hostname }}</strong></td>
                    <td><code>{{ instance.id }}</code></td>
                    <td>
                        <span class="status-badge status-{{ instance.status|lower }}">
                            {{ instance.status }}
                        </span>
                    </td>
                    <td class="text-right">
                        <a href="{{ base_url }}/instance/{{ instance.id }}" class="btn-secondary btn-sm">Details</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="pagination-container mt-5">
    <div class="pagination-info">
        Showing {{ instances.len() }} of {{ total_count }} instances
    </div>
    
    {% if total_pages > 1 %}
    <nav class="pagination" aria-label="Instance pagination">
        <div class="pagination-controls">
            {% if current_page > 1 %}
            <a href="{{ base_url }}/instances?page={{ current_page - 1 }}&per_page={{ per_page }}" class="pagination-btn" aria-label="Previous page">
                <span aria-hidden="true">←</span> Previous
            </a>
            {% else %}
            <span class="pagination-btn pagination-btn-disabled">
                <span aria-hidden="true">←</span> Previous
            </span>
            {% endif %}
            
            <div class="pagination-numbers">
                {% for p in 1..total_pages + 1 %}
                    {% if p == current_page %}
                    <span class="pagination-number pagination-number-active">{{ p }}</span>
                    {% else %}
                    <a href="{{ base_url }}/instances?page={{ p }}&per_page={{ per_page }}" class="pagination-number">{{ p }}</a>
                    {% endif %}
                {% endfor %}
            </div>
            
            {% if current_page < total_pages %}
            <a href="{{ base_url }}/instances?page={{ current_page + 1 }}&per_page={{ per_page }}" class="pagination-btn" aria-label="Next page">
                Next <span aria-hidden="true">→</span>
            </a>
            {% else %}
            <span class="pagination-btn pagination-btn-disabled">
                Next <span aria-hidden="true">→</span>
            </span>
            {% endif %}
        </div>
    </nav>
    {% endif %}
</div>

{% else %}
<div class="empty-state mt-6">
    <p>No instances found.</p>
</div>
{% endif %}
{% endblock %}