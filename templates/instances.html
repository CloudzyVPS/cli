{% extends "base.html" %}

{% block title %}Instances{% endblock %}

{% block content %}
<h1>Instances</h1>

{% if instances.len() > 0 %}
<div class="table-responsive mt-4">
    <table class="table table-responsive">
        <thead>
            <tr>
                <th>Hostname</th>
                <th>ID</th>
                <th>Network</th>
                <th>Status</th>
                <th class="text-right">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for instance in instances %}
                <tr>
                    <td data-label="Hostname"><strong>{{ instance.hostname }}</strong></td>
                    <td data-label="ID"><code>{{ instance.id }}</code></td>
                    <td data-label="Network">
                        {% if instance.main_ip.is_some() %}
                        <div class="small">{{ instance.main_ip.as_ref().unwrap() }}</div>
                        {% endif %}
                        {% if instance.main_ipv6.is_some() %}
                        <div class="small text-muted">{{ instance.main_ipv6.as_ref().unwrap() }}</div>
                        {% endif %}
                        {% if instance.main_ip.is_none() && instance.main_ipv6.is_none() %}
                        <span class="text-muted small">â€”</span>
                        {% endif %}
                    </td>
                    <td data-label="Status">
                        <span class="status-badge status-{{ instance.status|lower }}">
                            {{ instance.status_display }}
                        </span>
                    </td>
                    <td data-label="Actions" class="text-right">
                        <a href="{{ base_url }}/instance/{{ instance.id }}" class="btn-secondary btn-sm">Details</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="pagination-container">
    <div class="pagination-info">
        Showing <strong>{{ instances.len() }}</strong> of <strong>{{ total_count }}</strong> instances
    </div>
    
    <div class="per-page-selector">
        <span class="text-muted small">Items per page:</span>
        <div class="d-flex gap-sm">
            <a href="{{ base_url }}/instances?per_page=10&page=1" class="btn {% if per_page == 10 %}btn-primary{% else %}btn-secondary{% endif %} btn-sm">10</a>
            <a href="{{ base_url }}/instances?per_page=20&page=1" class="btn {% if per_page == 20 %}btn-primary{% else %}btn-secondary{% endif %} btn-sm">20</a>
            <a href="{{ base_url }}/instances?per_page=50&page=1" class="btn {% if per_page == 50 %}btn-primary{% else %}btn-secondary{% endif %} btn-sm">50</a>
            <a href="{{ base_url }}/instances?per_page=100&page=1" class="btn {% if per_page == 100 %}btn-primary{% else %}btn-secondary{% endif %} btn-sm">100</a>
        </div>
    </div>
    
    <div class="pagination-controls" role="navigation" aria-label="Instance pagination">
        {% if total_pages > 1 %}
        <div class="pagination-numbers">
            {% for p in 1..total_pages + 1 %}
                {% if p == 1 || p == total_pages || (p >= current_page - 1 && p <= current_page + 1) %}
                    {% if p == current_page %}
                    <span class="pagination-number pagination-number-active">{{ p }}</span>
                    {% else %}
                    <a href="{{ base_url }}/instances?page={{ p }}&per_page={{ per_page }}" class="pagination-number">{{ p }}</a>
                    {% endif %}
                {% else if (p == 2 && current_page > 3) || (p == total_pages - 1 && current_page < total_pages - 2) %}
                    <span class="pagination-ellipsis">...</span>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

{% else %}
<div class="empty-state mt-6">
    <p>No instances found.</p>
</div>
{% endif %}
{% endblock %}