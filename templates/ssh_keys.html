{% extends "base.html" %}

{% block title %}SSH Keys{% endblock %}

{% block content %}
<header class="page-header">
    <div>
        <h1>SSH Keys</h1>
        <p>Manage the public keys that are available during instance provisioning. Changes take effect immediately.</p>
    </div>
</header>

<section class="surface" data-ssh-keys-panel>
    <header>
        <h2>Registered keys</h2>
        <p class="help-text">Delete keys that are no longer needed or keep them available for future deployments.</p>
    </header>
    {% if not ssh_keys %}
    <div class="empty-state">
        <div class="icon" aria-hidden="true">ðŸ”‘</div>
        <p>No SSH keys are registered yet. Use the form below to add your first key.</p>
    </div>
    {% else %}
    <div class="card-grid" data-ssh-keys-list>
        {% for key in ssh_keys %}
        <article class="metric-card" data-ssh-key>
            <header>
                <h3>{{ key.name }}</h3>
                <p class="help-text">ID #{{ key.id }}{% if key.customer_id %} Â· Customer {{ key.customer_id }}{% endif %}</p>
            </header>
            {% if key.fingerprint %}
            <p><strong>Fingerprint:</strong> {{ key.fingerprint }}</p>
            {% endif %}
            {% if key.public_key %}
            <pre>{{ key.public_key }}</pre>
            {% endif %}
            <footer>
                <form method="post" onsubmit="return confirm('Delete this SSH key?');">
                    <input type="hidden" name="action" value="delete">
                    <input type="hidden" name="ssh_key_id" value="{{ key.id }}">
                    <button type="submit" class="btn-danger">Delete</button>
                </form>
            </footer>
        </article>
        {% endfor %}
    </div>
    {% endif %}
</section>

<section class="surface" data-ssh-key-form>
    <header>
        <h2>Add a new SSH key</h2>
        <p class="help-text">Provide the key name and the complete public key string (usually starting with <code>ssh-</code>).</p>
    </header>
    <form method="post" novalidate>
        <input type="hidden" name="action" value="create">
        <div class="fields-grid">
            <div>
                <label for="ssh_name">Name</label>
                <input type="text" id="ssh_name" name="name" value="{{ form_values.name }}" required>
            </div>
            <div>
                <label for="ssh_customer">Customer ID (optional)</label>
                <input type="text" id="ssh_customer" name="customer_id" value="{{ form_values.customer_id }}" placeholder="Leave empty for current customer">
            </div>
        </div>
        <div>
            <label for="ssh_public_key">Public key</label>
            <textarea id="ssh_public_key" name="public_key" rows="5" required>{{ form_values.public_key }}</textarea>
        </div>
        <footer class="form-actions">
            <button type="submit">Add SSH key</button>
        </footer>
    </form>
</section>
{% endblock %}
