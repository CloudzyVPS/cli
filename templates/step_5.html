{% extends "base.html" %}

{% block title %}Create · Step 5{% endblock %}

{% block content %}
<header class="page-header">
    <p class="breadcrumb"><a href="{{ back_url }}">← Previous step</a></p>
    <h1>Operating System Selection</h1>
    <p>Step 5 of 7 · Choose the operating system to install</p>
</header>

<form method="get" action="{{ submit_url }}" class="surface" novalidate>
    <input type="hidden" name="hostnames" value="{{ hostnames_csv }}">
    <input type="hidden" name="region" value="{{ base_state.region }}">
    <input type="hidden" name="instance_class" value="{{ base_state.instance_class }}">
    <input type="hidden" name="plan_type" value="{{ base_state.plan_type }}">
    <input type="hidden" name="assign_ipv4" value="{% if base_state.assign_ipv4 %}1{% else %}0{% endif %}">
    <input type="hidden" name="assign_ipv6" value="{% if base_state.assign_ipv6 %}1{% else %}0{% endif %}">
    <input type="hidden" name="floating_ip_count" value="{{ floating_ip_count }}">
    <input type="hidden" name="ssh_key_ids" value="{{ ssh_key_ids_csv }}">
    {% if base_state.plan_type == "fixed" %}
    <input type="hidden" name="product_id" value="{{ product_id }}">
    <input type="hidden" name="extra_disk" value="{{ extra_disk }}">
    <input type="hidden" name="extra_bandwidth" value="{{ extra_bandwidth }}">
    {% else %}
    <input type="hidden" name="cpu" value="{{ custom_plan.cpu }}">
    <input type="hidden" name="ramInGB" value="{{ custom_plan.ram_in_gb }}">
    <input type="hidden" name="diskInGB" value="{{ custom_plan.disk_in_gb }}">
    <input type="hidden" name="bandwidthInTB" value="{{ custom_plan.bandwidth_in_tb }}">
    {% endif %}
    <fieldset>
        <legend>Operating System</legend>
        {% if os_list.len() > 0 %}
        <div class="product-grid" role="list">
            {% for os_item in os_list %}
            <label class="product-card" role="listitem" {% if selected_os_id == os_item.id %}aria-current="true"{% endif %}>
                <input type="radio" name="os_id" value="{{ os_item.id }}" {% if selected_os_id == os_item.id %}checked{% endif %} required>
                <div class="product-card-body">
                    <h2>{{ os_item.name }}</h2>
                    {% if os_item.family != "" %}
                    <p class="product-plan">
                        {{ os_item.family }}{% if os_item.arch.is_some() %} · {{ os_item.arch.as_ref().unwrap() }}{% endif %}
                    </p>
                    {% else %}
                        {% if os_item.arch.is_some() %}
                        <p class="product-plan">
                            {{ os_item.arch.as_ref().unwrap() }}
                        </p>
                        {% endif %}
                    {% endif %}
                    {% if os_item.min_ram.is_some() %}
                    <dl>
                        <div>
                            <dt>Min RAM</dt>
                            <dd>{{ os_item.min_ram.as_ref().unwrap() }}</dd>
                        </div>
                    </dl>
                    {% endif %}
                    {% if os_item.is_default %}
                    <footer>
                        <p>Default</p>
                    </footer>
                    {% endif %}
                </div>
            </label>
            {% endfor %}
        </div>
        <p class="help-text">Select the operating system to install on your instance.</p>
        {% else %}
        <p class="form-help error">No operating systems are available for this plan.</p>
        {% endif %}
    <input type="hidden" name="os_id" value="{{ selected_os_id }}">
    
    <fieldset>
        <legend>One-Click Application (Optional)</legend>
        <p class="help-text">Optionally select a pre-configured application to install with your OS.</p>
        {% if applications.len() > 0 %}
        <div class="product-grid" role="list">
            <label class="product-card" role="listitem" {% if selected_app_id == "" %}aria-current="true"{% endif %}>
                <input type="radio" name="app_id" value="" {% if selected_app_id == "" %}checked{% endif %}>
                <div class="product-card-body">
                    <h2>None</h2>
                    <p class="product-plan">No application</p>
                </div>
            </label>
            {% for app in applications %}
            <label class="product-card" role="listitem" {% if selected_app_id == app.id %}aria-current="true"{% endif %}>
                <input type="radio" name="app_id" value="{{ app.id }}" {% if selected_app_id == app.id %}checked{% endif %}>
                <div class="product-card-body">
                    <h2>{{ app.name }}</h2>
                    {% if app.description.is_some() %}
                    <p class="product-plan">{{ app.description.as_ref().unwrap() }}</p>
                    {% endif %}
                    {% if app.category.is_some() %}
                    <dl>
                        <div>
                            <dt>Category</dt>
                            <dd>{{ app.category.as_ref().unwrap() }}</dd>
                        </div>
                    </dl>
                    {% endif %}
                </div>
            </label>
            {% endfor %}
        </div>
        {% else %}
        <p class="form-help">No applications available.</p>
        {% endif %}
    </fieldset>

    <footer class="form-actions">
        <button type="submit">Continue</button>
    </footer>
</form>
{% endblock %}

