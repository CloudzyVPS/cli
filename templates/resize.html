{% extends "base.html" %}

{% block title %}Resize Instance{% endblock %}

{% block content %}
<header class="page-header">
    <p class="breadcrumb"><a href="{{ base_url }}/instance/{{ instance.id }}">‚Üê Back to instance</a></p>
    <h1>Resize instance</h1>
    <p>Change the CPU, RAM, disk, or switch to a different fixed plan.</p>
</header>

<div class="warning-banner">
    <div>
        <h2>Warning: Service interruption</h2>
        <p>Resizing an instance may require a reboot or cause temporary downtime. Make sure you have backups and schedule maintenance windows if required.</p>
    </div>
</div>

<section>
    <fieldset>
        <legend>Instance details</legend>
        <dl>
            <div>
                <dt>Hostname</dt>
                <dd><strong>{{ instance.hostname }}</strong></dd>
            </div>
            <div>
                <dt>Instance ID</dt>
                <dd><code>{{ instance.id }}</code></dd>
            </div>
            <div>
                <dt>Current status</dt>
                <dd>{{ instance.status }}</dd>
            </div>
            <div>
                <dt>Region</dt>
                <dd>{{ instance.region }}</dd>
            </div>
        </dl>
    </fieldset>

    <form method="post" action="{{ base_url }}/instance/{{ instance.id }}/resize">
        <fieldset {% if disabled_by_env || disabled_by_host %}disabled{% endif %}>
            <legend>Resize options</legend>
            {% if disabled_by_env %}
            <div class="warning-banner mb-4">
                <p><strong>Instance locked:</strong> Actions are disabled for this instance via environment configuration (blacklisted ID).</p>
            </div>
            {% endif %}
            {% if disabled_by_host %}
            <div class="warning-banner mb-4">
                <p><strong>Host mismatch:</strong> Actions are disabled because this instance's hostname matches the application server's hostname.</p>
            </div>
            {% endif %}
            <div>
                <label for="type">Resize type</label>
                <select id="type" name="type" required>
                    <option value="FIXED">Fixed plan</option>
                    <option value="CUSTOM">Custom configuration</option>
                </select>
            </div>
            <div>
                <h3>Fixed plan</h3>
                <label for="product_id">Product ID</label>
                <input id="product_id" name="product_id" type="text" placeholder="Enter product ID" />
                <small>Enter the product id to upgrade to a fixed plan.</small>
                
                <label for="diskInGB_fixed">Extra Disk (GB) <small>(optional)</small></label>
                <input id="diskInGB_fixed" name="diskInGB" type="number" min="0" />
                <small>Additional disk space to add to the fixed plan.</small>
                
                <label for="bandwidthInTB_fixed">Extra Bandwidth (TB) <small>(optional)</small></label>
                <input id="bandwidthInTB_fixed" name="bandwidthInTB" type="number" min="0" />
                <small>Additional bandwidth to add to the fixed plan.</small>
            </div>

            <div>
                <h3>Custom configuration</h3>
                <label for="region_id">Region</label>
                <select id="region_id" name="region_id">
                    <option value="">(Select region)</option>
                    {% for region in regions %}
                    <option value="{{ region.id }}">{{ region.name }}</option>
                    {% endfor %}
                </select>

                <label for="cpu">CPU (cores)</label>
                <input id="cpu" name="cpu" type="number" />

                <label for="ramInGB">RAM (GB)</label>
                <input id="ramInGB" name="ramInGB" type="number" />

                <label for="diskInGB">Disk (GB)</label>
                <input id="diskInGB" name="diskInGB" type="number" />

                <label for="bandwidthInTB">Bandwidth (TB)</label>
                <input id="bandwidthInTB" name="bandwidthInTB" type="number" />
            </div>
        </fieldset>

        <footer class="mt-5">
            <a href="{{ base_url }}/instance/{{ instance.id }}">Cancel</a>
            {% if disabled_by_env || disabled_by_host %}
            <button type="button" disabled>Resize instance (Locked)</button>
            {% else %}
            <button type="submit">Resize instance</button>
            {% endif %}
        </footer>
    </form>
</section>
{% endblock %}